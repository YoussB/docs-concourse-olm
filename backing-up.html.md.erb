---
title: Backing Up and Restoring a Concourse OLM Database
owner: Concourse
---

Backing up Concourse OLM databases is a best practice that helps protect build history and team information over time. Pivotal recommends that you schedule periodic backups of Concourse OLM databases, before and after updates, or after other substantial changes. 

You can also use backed up versions of databases to restore database states after unexpected problems, like database failure, corruption, or interference from malicious third parties. Specifically, the backup and restore process restores build history, pipelines, and team information. It cannot restore builds that were running at the time of backup.

This topic explains both how to back up a database, and how to restore it. 

## Backing Up a Concourse OLM Database

This procedure explains how to back up a Concourse OLM database. This procedure requires a PostgreSQL database. 

<ol>
<li>SSH into your database VM. You may want to use <a href="https://bosh.io/docs/sysadmin-commands.html#ssh">BOSH SSH</a>.</li>
<li>Open a terminal window.</li>
<li>Locate the Postgres binaries on your VM by entering the following command:<br/>
<pre class="terminal">
ps aux | grep postgres
</pre>

The binary location displays.
</li>
<li>Switch to the <code>vcap</code> user. This user has permissions to use the backup and restore commands.<br/>
<pre class="terminal">
sudo su vcap
</pre>
</li>
<li>Navigate to the root directory.<br/>
<pre class="terminal">
cd ~
</pre>
</li>
<li>Enter the command to generate a backup file:

<pre class="terminal">
POSTGRES-BINARY-LOCATION/pg_dumpall -c -f /FILEPATH/BACKUP-FILE-NAME
</pre>

When you generate the backup file, you can use any name and any file extension. For example: "january-backup.txt".

<p class="note"><strong>Note</strong>: The -c flag will wipe any unsaved data on the database. When you back up the database, check to be sure you have saved any important data.
</p>
</li>

<li>Extract the backup file from the VM. You may want to use <a href="https://bosh.io/docs/cli-v2.html#errand-mgmt">BOSH SCP</a>.</li>
<li>Store the backup file somewhere secure.</li>
</ol>

## Restoring a Concourse OLM Database

Once youâ€™ve generated a backup file, you can apply it to a database to restore a previous state. Do not use a backup file to overwrite an existing database. Overwriting databases will lead to data loss, and may lead to total deployment failure. Only apply a backup to a new database.

<ol>
	<li>Insert your backup file into the database VM. You may want to use <a href="https://bosh.io/docs/cli-v2.html#errand-mgmt">BOSH SCP<a>.</li>
	<li>SSH into your database VM. You may want to use <a href="https://bosh.io/docs/sysadmin-commands.html#ssh">BOSH SSH</a>.</li>
	<li>Locate the Postgres binaries on your VM by entering the following command:<br/>
	<pre class="terminal">ps aux | grep postgres</pre>
	The binary location displays.
	</li>
	<li>Switch to the <code>vcap</code> user. This user has permissions to use the backup and restore commands.<br/>
	<pre class="terminal">sudo su vcap</pre></li>
	<li>Navigate to the root directory.<br/>
	<pre class="terminal">cd ~</pre></li>
	<li>
	Apply the backup file to the database.
	<pre class="terminal">psql -f BACKUP-FILE-NAME</pre></li>
</ol>